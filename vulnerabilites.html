<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vuln√©rabilit√©s ‚Äî Cours S√©curit√© PHP & MySQL</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script defer src="assets/site.js"></script>
</head>
<body>
  <a href="#contenu" class="skip-link">Aller au contenu</a>
  <header class="site-header" role="banner">
    <div class="container navbar">
      <a class="brand" href="index.html" aria-label="Accueil">
        <span class="logo">SP</span>
        <span>S√©curit√© PHP & MySQL</span>
      </a>
      <button class="nav-toggle" aria-controls="primary-nav" aria-expanded="false" aria-label="Ouvrir le menu">
        <span class="bar"></span><span aria-hidden="true">Menu</span>
      </button>
      <nav id="primary-nav" class="nav" aria-label="Navigation principale">
        <ul>
          <li><a href="index.html">Introduction</a></li>
          <li><a href="php-poo.html">PHP POO</a></li>
          <li><a href="mysql.html">MySQL & PDO</a></li>
          <li><a href="vulnerabilites.html">Vuln√©rabilit√©s</a></li>
          <li><a href="securisation.html">S√©curisation</a></li>
          <li><a href="modules.html">Modules & Outils</a></li>
          <li><a href="projet.html">Projet final</a></li>
          <li><a href="exercices.html">Exercices</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="contenu" class="container">

    <section class="hero card">
      <h1>üß® Vuln√©rabilit√©s courantes</h1>
      <p>SQLi, XSS, CSRF, sessions, uploads ‚Äî nous allons les comprendre avec des exemples concrets.</p>
    </section>

    <!-- SQL Injection -->
    <section class="card">
      <h2>1) SQL Injection (Injection SQL)</h2>
      <p>Analogie : un pirate glisse des instructions dans la commande que tu passes au serveur, comme si quelqu‚Äôun √©crivait dans la commande de la cuisine pour voler un plat.</p>
      <div class="example">
        <p><strong>‚ö†Ô∏è Exemple vuln√©rable :</strong></p>
        <pre><code class="php">
// concat√©nation directe ‚Üí injection possible
$sql = "SELECT * FROM users WHERE username = '" . $_GET['u'] . "'";
$result = $pdo->query($sql);
        </code></pre>
        <p>Test : <code>?u=' OR '1'='1</code> permet de r√©cup√©rer tous les utilisateurs.</p>
      </div>
      <div class="secure">
        <p><strong>‚úÖ Exemple s√©curis√© :</strong></p>
        <pre><code class="php">
// requ√™te pr√©par√©e avec PDO
$stmt = $pdo->prepare("SELECT * FROM users WHERE username = :u");
$stmt->execute([':u' => $_GET['u']]);
$user = $stmt->fetch();
        </code></pre>
        <p>‚úÖ Les entr√©es utilisateurs sont trait√©es comme du texte, aucune instruction SQL n‚Äôest inject√©e.</p>
      </div>
    </section>

    <!-- XSS -->
    <section class="card">
      <h2>2) XSS (Cross-Site Scripting)</h2>
      <p>Analogie : quelqu‚Äôun √©crit un message avec du poison invisible sur ton assiette. Si tu affiches le message sans contr√¥le, le poison s‚Äôex√©cute dans le navigateur.</p>
      <div class="example">
        <p><strong>‚ö†Ô∏è Exemple vuln√©rable :</strong></p>
        <pre><code class="php">
// affichage brut d‚Äôun commentaire
echo $_POST['comment'];
        </code></pre>
        <p>Un pirate peut mettre : <code>&lt;script&gt;alert('Hacked')&lt;/script&gt;</code></p>
      </div>
      <div class="secure">
        <p><strong>‚úÖ Exemple s√©curis√© :</strong></p>
        <pre><code class="php">
// √©chappement HTML
echo htmlspecialchars($_POST['comment'] ?? '', ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8');
        </code></pre>
        <p>‚úÖ Le code HTML/JS est transform√© en texte, donc ne s‚Äôex√©cute pas.</p>
      </div>
    </section>

    <!-- CSRF -->
    <section class="card">
      <h2>3) CSRF (Cross-Site Request Forgery)</h2>
      <p>Analogie : quelqu‚Äôun envoie une commande √† la cuisine en se faisant passer pour toi. Sans v√©rification, le serveur ex√©cute l‚Äôaction.</p>
      <div class="example">
        <p><strong>‚ö†Ô∏è Exemple vuln√©rable :</strong></p>
        <pre><code class="php">
// formulaire POST sensible sans v√©rification
// n‚Äôimporte qui peut soumettre des actions au nom de l‚Äôutilisateur
        </code></pre>
      </div>
      <div class="secure">
        <p><strong>‚úÖ Exemple s√©curis√© :</strong></p>
        <pre><code class="php">
// g√©n√©rer token CSRF
$_SESSION['csrf'] = bin2hex(random_bytes(32));
// ajouter dans le formulaire : <input type="hidden" name="csrf" value="<?= $_SESSION['csrf'] ?>">
if (!hash_equals($_SESSION['csrf'] ?? '', $_POST['csrf'] ?? '')) exit('CSRF');
        </code></pre>
        <p>‚úÖ Seul un formulaire l√©gitime peut effectuer l‚Äôaction.</p>
      </div>
    </section>

    <!-- Sessions -->
    <section class="card">
      <h2>4) Sessions</h2>
      <p>Analogie : le serveur te donne un badge pour te reconna√Ætre. Si le badge est vol√©, un pirate peut se faire passer pour toi.</p>
      <div class="example">
        <p><strong>‚ö†Ô∏è Mauvaise pratique :</strong></p>
        <pre><code class="php">
// session non s√©curis√©e
session_start();
$_SESSION['user'] = $username;
        </code></pre>
      </div>
      <div class="secure">
        <p><strong>‚úÖ Bonne pratique :</strong></p>
        <pre><code class="php">
// session s√©curis√©e
session_start([
    'cookie_httponly' => true,
    'cookie_secure' => true, // si HTTPS
    'use_strict_mode' => true
]);
$_SESSION['user'] = $username;
        </code></pre>
      </div>
    </section>

    <!-- Upload -->
    <section class="card">
      <h2>5) Upload de fichiers</h2>
      <p>Analogie : quelqu‚Äôun apporte un plat suspect dans ta cuisine. Si tu ne v√©rifies pas, √ßa peut casser ton serveur.</p>
      <div class="example">
        <p><strong>‚ö†Ô∏è Vuln√©rable :</strong></p>
        <pre><code class="php">
// upload sans v√©rification
move_uploaded_file($_FILES['file']['tmp_name'], "uploads/" . $_FILES['file']['name']);
        </code></pre>
        <p>Un pirate peut uploader un script PHP et l‚Äôex√©cuter.</p>
      </div>
      <div class="secure">
        <p><strong>‚úÖ S√©curis√© :</strong></p>
        <pre><code class="php">
// v√©rifier type et extension
$allowed = ['jpg','png','pdf'];
$ext = pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION);
if(!in_array(strtolower($ext), $allowed)) exit('Fichier non autoris√©');
// changer nom et r√©pertoire s√©curis√©
move_uploaded_file($_FILES['file']['tmp_name'], "uploads/" . bin2hex(random_bytes(8)) . ".$ext");
        </code></pre>
        <p>‚úÖ On ne peut plus ex√©cuter de code malveillant via l‚Äôupload.</p>
      </div>
    </section>

    <!-- Mini exercices -->
    <section class="card">
      <h2>6) Exercices pratiques</h2>
      <ul>
        <li>Tester l‚Äôinjection SQL sur un petit formulaire et corriger avec PDO</li>
        <li>Essayer de poster un commentaire XSS et s√©curiser avec <code>htmlspecialchars</code></li>
        <li>Ajouter un token CSRF sur un formulaire sensible</li>
        <li>Tester un upload avec fichier dangereux et s√©curiser</li>
        <li>V√©rifier les sessions s√©curis√©es avec HttpOnly/Secure</li>
      </ul>
    </section>

  </main>

  <footer role="contentinfo">
    <div class="container">
      <p>¬© Vuln√©rabilit√©s ¬∑ Cours p√©dagogique ‚Äî PHP POO ¬∑ MySQL ¬∑ S√©curit√© ¬∑ Accessibilit√©</p>
    </div>
  </footer>
</body>
</html>
